module Lib;

// AT-1: cursor on assoc type declaration (line 3, col 9)
// AT-4: cursor on assoc type usage in type (line 4, col 35)
trait iter : MyIterator {
    type Item iter;
    advance : iter -> Option (iter, MyIterator::Item iter);
}

type MyIter = unbox struct { idx: I64 };

// AT-2: cursor on assoc type impl LHS (line 11, col 9)
impl MyIter : MyIterator {
    type Item MyIter = I64;
    advance = |it| (
        if it.@idx >= 10 { none() };
        some $ (MyIter { idx: it.@idx + 1 }, it.@idx)
    );
}

// AT-3: cursor on assoc type in Equality constraint (line 20, col 30)
sum_iter : [iter : MyIterator, MyIterator::Item iter = I64] iter -> I64;
sum_iter = |it| (
    loop((0, it), |(acc, it)| (
        match it.advance {
            none() => break $ acc,
            some((next_it, val)) => continue $ (acc + val, next_it)
        }
    ))
);

// AT-5: higher arity associated type
trait n : Nat {
    type Add n m;
}

type Zero = unbox struct {};
type Succ n = unbox struct { pred: n };

impl Zero : Nat {
    type Add Zero m = m;
}
